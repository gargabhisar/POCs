@using BookInventory.Models
@model List<Message>

@foreach (var m in Model)
{
    var isOut = m.Direction == "OUT";

    string statusColor = m.DeliveryStatus switch
    {
        "sent" => "#6c757d",
        "delivered" => "#0d6efd",
        "read" => "#198754",
        "failed" => "#dc3545",
        _ => "#6c757d"
    };

    string statusIcon = m.DeliveryStatus switch
    {
        "sent" => "✓",
        "delivered" => "✓✓",
        "read" => "✓✓",
        "failed" => "⚠",
        _ => ""
    };

    <div class="mb-3 d-flex @(isOut ? "justify-content-end" : "justify-content-start")">
        <div style="max-width:70%;">

            <!-- Message bubble -->
            <div class="message-bubble @(isOut ? "out" : "in")">
                @Html.Raw(System.Net.WebUtility.HtmlEncode(m.Text.Trim()).Replace("\n", "<br />"))
            </div>

            <!-- Status (OUT only) -->
            @if (isOut)
            {
                <div class="text-end mt-1"
                     style="font-size:0.75rem; color:@statusColor">
                    @statusIcon @m.DeliveryStatus
                </div>
            }
        </div>
    </div>
}
